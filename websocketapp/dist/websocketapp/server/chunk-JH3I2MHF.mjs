import './polyfills.server.mjs';
import{$ as vi,A as j,B as ke,C as Me,D as ie,E as ai,F as li,G as ci,H as ui,I as hi,J as di,K as ot,M as fi,R as pi,T as mi,U as at,W as gi,X as _i,Y as yi,a as Zt,b as Xt,c as Jt,d as Qt,da as bi,e as it,f as nt,g as F,ga as lt,h as ee,i as ei,j as Ve,k as De,l as I,m as te,n as ti,o as ii,p as rt,q as Ae,r as $,s as w,t as st,u as ni,v as de,w as ri,x as si,y as oi,z as W}from"./chunk-YGAAEED7.mjs";import{a as y,b as S,c as p,e as v,h as tt}from"./chunk-VVCT4QZE.mjs";var T=v((La,Yi)=>{"use strict";var qi=["nodebuffer","arraybuffer","fragments"],zi=typeof Blob<"u";zi&&qi.push("blob");Yi.exports={BINARY_TYPES:qi,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:zi,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var hn=v((Ra,un)=>{"use strict";var Ji=p("fs"),P=p("path"),Qi=p("os"),en=typeof __webpack_require__=="function"?__non_webpack_require__:p,is=process.config&&process.config.variables||{},ns=!!process.env.PREBUILDS_ONLY,Ki=process.versions.modules,mt=os()?"electron":ss()?"node-webkit":"node",gt=process.env.npm_config_arch||Qi.arch(),_t=process.env.npm_config_platform||Qi.platform(),tn=process.env.LIBC||(as(_t)?"musl":"glibc"),yt=process.env.ARM_VERSION||(gt==="arm64"?"8":is.arm_version)||"",nn=(process.versions.uv||"").split(".")[0];un.exports=O;function O(i){return en(O.resolve(i))}O.resolve=O.path=function(i){i=P.resolve(i||".");try{var e=en(P.join(i,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[e+"_PREBUILD"]&&(i=process.env[e+"_PREBUILD"])}catch{}if(!ns){var t=Zi(P.join(i,"build/Release"),Xi);if(t)return t;var n=Zi(P.join(i,"build/Debug"),Xi);if(n)return n}var r=a(i);if(r)return r;var s=a(P.dirname(process.execPath));if(s)return s;var o=["platform="+_t,"arch="+gt,"runtime="+mt,"abi="+Ki,"uv="+nn,yt?"armv="+yt:"","libc="+tn,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"",typeof __webpack_require__=="function"?"webpack=true":""].filter(Boolean).join(" ");throw new Error("No native build was found for "+o+`
    loaded from: `+i+`
`);function a(l){var c=vt(P.join(l,"prebuilds")).map(rn),u=c.filter(sn(_t,gt)).sort(on)[0];if(u){var h=P.join(l,"prebuilds",u.name),f=vt(h).map(an),_=f.filter(ln(mt,Ki)),m=_.sort(cn(mt))[0];if(m)return P.join(h,m.file)}}};function vt(i){try{return Ji.readdirSync(i)}catch{return[]}}function Zi(i,e){var t=vt(i).filter(e);return t[0]&&P.join(i,t[0])}function Xi(i){return/\.node$/.test(i)}function rn(i){var e=i.split("-");if(e.length===2){var t=e[0],n=e[1].split("+");if(t&&n.length&&n.every(Boolean))return{name:i,platform:t,architectures:n}}}function sn(i,e){return function(t){return t==null||t.platform!==i?!1:t.architectures.includes(e)}}function on(i,e){return i.architectures.length-e.architectures.length}function an(i){var e=i.split("."),t=e.pop(),n={file:i,specificity:0};if(t==="node"){for(var r=0;r<e.length;r++){var s=e[r];if(s==="node"||s==="electron"||s==="node-webkit")n.runtime=s;else if(s==="napi")n.napi=!0;else if(s.slice(0,3)==="abi")n.abi=s.slice(3);else if(s.slice(0,2)==="uv")n.uv=s.slice(2);else if(s.slice(0,4)==="armv")n.armv=s.slice(4);else if(s==="glibc"||s==="musl")n.libc=s;else continue;n.specificity++}return n}}function ln(i,e){return function(t){return!(t==null||t.runtime&&t.runtime!==i&&!rs(t)||t.abi&&t.abi!==e&&!t.napi||t.uv&&t.uv!==nn||t.armv&&t.armv!==yt||t.libc&&t.libc!==tn)}}function rs(i){return i.runtime==="node"&&i.napi}function cn(i){return function(e,t){return e.runtime!==t.runtime?e.runtime===i?-1:1:e.abi!==t.abi?e.abi?-1:1:e.specificity!==t.specificity?e.specificity>t.specificity?-1:1:0}}function ss(){return!!(process.versions&&process.versions.nw)}function os(){return process.versions&&process.versions.electron||process.env.ELECTRON_RUN_AS_NODE?!0:typeof window<"u"&&window.process&&window.process.type==="renderer"}function as(i){return i==="linux"&&Ji.existsSync("/etc/alpine-release")}O.parseTags=an;O.matchTags=ln;O.compareTags=cn;O.parseTuple=rn;O.matchTuple=sn;O.compareTuples=on});var Et=v((Wa,Ct)=>{"use strict";var bt=typeof __webpack_require__=="function"?__non_webpack_require__:p;typeof bt.addon=="function"?Ct.exports=bt.addon.bind(bt):Ct.exports=hn()});var fn=v((Ga,dn)=>{"use strict";var ls=(i,e,t,n,r)=>{for(var s=0;s<r;s++)t[n+s]=i[s]^e[s&3]},cs=(i,e)=>{let t=i.length;for(var n=0;n<t;n++)i[n]^=e[n&3]};dn.exports={mask:ls,unmask:cs}});var pn=v((Ha,St)=>{"use strict";try{St.exports=Et()(__dirname)}catch{St.exports=fn()}});var _e=v(($a,Ue)=>{"use strict";var{EMPTY_BUFFER:us}=T(),wt=Buffer[Symbol.species];function hs(i,e){if(i.length===0)return us;if(i.length===1)return i[0];let t=Buffer.allocUnsafe(e),n=0;for(let r=0;r<i.length;r++){let s=i[r];t.set(s,n),n+=s.length}return n<e?new wt(t.buffer,t.byteOffset,n):t}function mn(i,e,t,n,r){for(let s=0;s<r;s++)t[n+s]=i[s]^e[s&3]}function gn(i,e){for(let t=0;t<i.length;t++)i[t]^=e[t&3]}function ds(i){return i.length===i.buffer.byteLength?i.buffer:i.buffer.slice(i.byteOffset,i.byteOffset+i.length)}function xt(i){if(xt.readOnly=!0,Buffer.isBuffer(i))return i;let e;return i instanceof ArrayBuffer?e=new wt(i):ArrayBuffer.isView(i)?e=new wt(i.buffer,i.byteOffset,i.byteLength):(e=Buffer.from(i),xt.readOnly=!1),e}Ue.exports={concat:hs,mask:mn,toArrayBuffer:ds,toBuffer:xt,unmask:gn};if(!process.env.WS_NO_BUFFER_UTIL)try{let i=pn();Ue.exports.mask=function(e,t,n,r,s){s<48?mn(e,t,n,r,s):i.mask(e,t,n,r,s)},Ue.exports.unmask=function(e,t){e.length<32?gn(e,t):i.unmask(e,t)}}catch{}});var vn=v((qa,yn)=>{"use strict";var _n=Symbol("kDone"),Vt=Symbol("kRun"),Dt=class{constructor(e){this[_n]=()=>{this.pending--,this[Vt]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[Vt]()}[Vt](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[_n])}}};yn.exports=Dt});var be=v((za,Sn)=>{"use strict";var ye=p("zlib"),bn=_e(),fs=vn(),{kStatusCode:Cn}=T(),ps=Buffer[Symbol.species],ms=Buffer.from([0,0,255,255]),Ge=Symbol("permessage-deflate"),B=Symbol("total-length"),ve=Symbol("callback"),G=Symbol("buffers"),je=Symbol("error"),We,At=class{constructor(e,t,n){if(this._maxPayload=n|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!We){let r=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;We=new fs(r)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[ve];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,n=e.find(r=>!(t.serverNoContextTakeover===!1&&r.server_no_context_takeover||r.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>r.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!r.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(n.server_no_context_takeover=!0),t.clientNoContextTakeover&&(n.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(n.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?n.client_max_window_bits=t.clientMaxWindowBits:(n.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete n.client_max_window_bits,n}acceptAsClient(e){let t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(n=>{let r=t[n];if(r.length>1)throw new Error(`Parameter "${n}" must have only a single value`);if(r=r[0],n==="client_max_window_bits"){if(r!==!0){let s=+r;if(!Number.isInteger(s)||s<8||s>15)throw new TypeError(`Invalid value for parameter "${n}": ${r}`);r=s}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${n}": ${r}`)}else if(n==="server_max_window_bits"){let s=+r;if(!Number.isInteger(s)||s<8||s>15)throw new TypeError(`Invalid value for parameter "${n}": ${r}`);r=s}else if(n==="client_no_context_takeover"||n==="server_no_context_takeover"){if(r!==!0)throw new TypeError(`Invalid value for parameter "${n}": ${r}`)}else throw new Error(`Unknown parameter "${n}"`);t[n]=r})}),e}decompress(e,t,n){We.add(r=>{this._decompress(e,t,(s,o)=>{r(),n(s,o)})})}compress(e,t,n){We.add(r=>{this._compress(e,t,(s,o)=>{r(),n(s,o)})})}_decompress(e,t,n){let r=this._isServer?"client":"server";if(!this._inflate){let s=`${r}_max_window_bits`,o=typeof this.params[s]!="number"?ye.Z_DEFAULT_WINDOWBITS:this.params[s];this._inflate=ye.createInflateRaw(S(y({},this._options.zlibInflateOptions),{windowBits:o})),this._inflate[Ge]=this,this._inflate[B]=0,this._inflate[G]=[],this._inflate.on("error",_s),this._inflate.on("data",En)}this._inflate[ve]=n,this._inflate.write(e),t&&this._inflate.write(ms),this._inflate.flush(()=>{let s=this._inflate[je];if(s){this._inflate.close(),this._inflate=null,n(s);return}let o=bn.concat(this._inflate[G],this._inflate[B]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[B]=0,this._inflate[G]=[],t&&this.params[`${r}_no_context_takeover`]&&this._inflate.reset()),n(null,o)})}_compress(e,t,n){let r=this._isServer?"server":"client";if(!this._deflate){let s=`${r}_max_window_bits`,o=typeof this.params[s]!="number"?ye.Z_DEFAULT_WINDOWBITS:this.params[s];this._deflate=ye.createDeflateRaw(S(y({},this._options.zlibDeflateOptions),{windowBits:o})),this._deflate[B]=0,this._deflate[G]=[],this._deflate.on("data",gs)}this._deflate[ve]=n,this._deflate.write(e),this._deflate.flush(ye.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let s=bn.concat(this._deflate[G],this._deflate[B]);t&&(s=new ps(s.buffer,s.byteOffset,s.length-4)),this._deflate[ve]=null,this._deflate[B]=0,this._deflate[G]=[],t&&this.params[`${r}_no_context_takeover`]&&this._deflate.reset(),n(null,s)})}};Sn.exports=At;function gs(i){this[G].push(i),this[B]+=i.length}function En(i){if(this[B]+=i.length,this[Ge]._maxPayload<1||this[B]<=this[Ge]._maxPayload){this[G].push(i);return}this[je]=new RangeError("Max payload size exceeded"),this[je].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[je][Cn]=1009,this.removeListener("data",En),this.reset()}function _s(i){this[Ge]._inflate=null,i[Cn]=1007,this[ve](i)}});var xn=v((Ka,wn)=>{"use strict";function ys(i){let e=i.length,t=0;for(;t<e;)if(!(i[t]&128))t++;else if((i[t]&224)===192){if(t+1===e||(i[t+1]&192)!==128||(i[t]&254)===192)return!1;t+=2}else if((i[t]&240)===224){if(t+2>=e||(i[t+1]&192)!==128||(i[t+2]&192)!==128||i[t]===224&&(i[t+1]&224)===128||i[t]===237&&(i[t+1]&224)===160)return!1;t+=3}else if((i[t]&248)===240){if(t+3>=e||(i[t+1]&192)!==128||(i[t+2]&192)!==128||(i[t+3]&192)!==128||i[t]===240&&(i[t+1]&240)===128||i[t]===244&&i[t+1]>143||i[t]>244)return!1;t+=4}else return!1;return!0}wn.exports=ys});var Vn=v((Za,kt)=>{"use strict";try{kt.exports=Et()(__dirname)}catch{kt.exports=xn()}});var se=v((Xa,He)=>{"use strict";var{isUtf8:Dn}=p("buffer"),{hasBlob:vs}=T(),bs=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Cs(i){return i>=1e3&&i<=1014&&i!==1004&&i!==1005&&i!==1006||i>=3e3&&i<=4999}function Mt(i){let e=i.length,t=0;for(;t<e;)if(!(i[t]&128))t++;else if((i[t]&224)===192){if(t+1===e||(i[t+1]&192)!==128||(i[t]&254)===192)return!1;t+=2}else if((i[t]&240)===224){if(t+2>=e||(i[t+1]&192)!==128||(i[t+2]&192)!==128||i[t]===224&&(i[t+1]&224)===128||i[t]===237&&(i[t+1]&224)===160)return!1;t+=3}else if((i[t]&248)===240){if(t+3>=e||(i[t+1]&192)!==128||(i[t+2]&192)!==128||(i[t+3]&192)!==128||i[t]===240&&(i[t+1]&240)===128||i[t]===244&&i[t+1]>143||i[t]>244)return!1;t+=4}else return!1;return!0}function Es(i){return vs&&typeof i=="object"&&typeof i.arrayBuffer=="function"&&typeof i.type=="string"&&typeof i.stream=="function"&&(i[Symbol.toStringTag]==="Blob"||i[Symbol.toStringTag]==="File")}He.exports={isBlob:Es,isValidStatusCode:Cs,isValidUTF8:Mt,tokenChars:bs};if(Dn)He.exports.isValidUTF8=function(i){return i.length<24?Mt(i):Dn(i)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let i=Vn();He.exports.isValidUTF8=function(e){return e.length<32?Mt(e):i(e)}}catch{}});var Tt=v((Ja,In)=>{"use strict";var{Writable:Ss}=p("stream"),An=be(),{BINARY_TYPES:ws,EMPTY_BUFFER:kn,kStatusCode:xs,kWebSocket:Vs}=T(),{concat:Ot,toArrayBuffer:Ds,unmask:As}=_e(),{isValidStatusCode:ks,isValidUTF8:Mn}=se(),$e=Buffer[Symbol.species],D=0,On=1,Nn=2,Fn=3,Nt=4,Ft=5,qe=6,It=class extends Ss{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||ws[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[Vs]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=D}_write(e,t,n){if(this._opcode===8&&this._state==D)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let n=this._buffers[0];return this._buffers[0]=new $e(n.buffer,n.byteOffset+e,n.length-e),new $e(n.buffer,n.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let n=this._buffers[0],r=t.length-e;e>=n.length?t.set(this._buffers.shift(),r):(t.set(new Uint8Array(n.buffer,n.byteOffset,e),r),this._buffers[0]=new $e(n.buffer,n.byteOffset+e,n.length-e)),e-=n.length}while(e>0);return t}startLoop(e){this._loop=!0;do switch(this._state){case D:this.getInfo(e);break;case On:this.getPayloadLength16(e);break;case Nn:this.getPayloadLength64(e);break;case Fn:this.getMask();break;case Nt:this.getData(e);break;case Ft:case qe:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if(t[0]&48){let r=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(r);return}let n=(t[0]&64)===64;if(n&&!this._extensions[An.extensionName]){let r=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(r);return}if(this._fin=(t[0]&128)===128,this._opcode=t[0]&15,this._payloadLength=t[1]&127,this._opcode===0){if(n){let r=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(r);return}if(!this._fragmented){let r=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(r);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let r=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(r);return}this._compressed=n}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let r=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(r);return}if(n){let r=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(r);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let r=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(r);return}}else{let r=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(r);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(t[1]&128)===128,this._isServer){if(!this._masked){let r=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(r);return}}else if(this._masked){let r=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(r);return}this._payloadLength===126?this._state=On:this._payloadLength===127?this._state=Nn:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),n=t.readUInt32BE(0);if(n>Math.pow(2,21)-1){let r=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(r);return}this._payloadLength=n*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let t=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(t);return}this._masked?this._state=Fn:this._state=Nt}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=Nt}getData(e){let t=kn;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3]&&As(t,this._mask)}if(this._opcode>7){this.controlMessage(t,e);return}if(this._compressed){this._state=Ft,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,t){this._extensions[An.extensionName].decompress(e,this._fin,(r,s)=>{if(r)return t(r);if(s.length){if(this._messageLength+=s.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let o=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");t(o);return}this._fragments.push(s)}this.dataMessage(t),this._state===D&&this.startLoop(t)})}dataMessage(e){if(!this._fin){this._state=D;return}let t=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let r;this._binaryType==="nodebuffer"?r=Ot(n,t):this._binaryType==="arraybuffer"?r=Ds(Ot(n,t)):this._binaryType==="blob"?r=new Blob(n):r=n,this._allowSynchronousEvents?(this.emit("message",r,!0),this._state=D):(this._state=qe,setImmediate(()=>{this.emit("message",r,!0),this._state=D,this.startLoop(e)}))}else{let r=Ot(n,t);if(!this._skipUTF8Validation&&!Mn(r)){let s=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(s);return}this._state===Ft||this._allowSynchronousEvents?(this.emit("message",r,!1),this._state=D):(this._state=qe,setImmediate(()=>{this.emit("message",r,!1),this._state=D,this.startLoop(e)}))}}controlMessage(e,t){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,kn),this.end();else{let n=e.readUInt16BE(0);if(!ks(n)){let s=this.createError(RangeError,`invalid status code ${n}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");t(s);return}let r=new $e(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!Mn(r)){let s=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");t(s);return}this._loop=!1,this.emit("conclude",n,r),this.end()}this._state=D;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=D):(this._state=qe,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=D,this.startLoop(t)}))}createError(e,t,n,r,s){this._loop=!1,this._errored=!0;let o=new e(n?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(o,this.createError),o.code=s,o[xs]=r,o}};In.exports=It});var Lt=v((el,Bn)=>{"use strict";var{Duplex:Qa}=p("stream"),{randomFillSync:Ms}=p("crypto"),Tn=be(),{EMPTY_BUFFER:Os,kWebSocket:Ns,NOOP:Fs}=T(),{isBlob:oe,isValidStatusCode:Is}=se(),{mask:Pn,toBuffer:z}=_e(),A=Symbol("kByteLength"),Ts=Buffer.alloc(4),ze=8*1024,Y,ae=ze,M=0,Ps=1,Bs=2,Pt=class i{constructor(e,t,n){this._extensions=t||{},n&&(this._generateMask=n,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=M,this.onerror=Fs,this[Ns]=void 0}static frame(e,t){let n,r=!1,s=2,o=!1;t.mask&&(n=t.maskBuffer||Ts,t.generateMask?t.generateMask(n):(ae===ze&&(Y===void 0&&(Y=Buffer.alloc(ze)),Ms(Y,0,ze),ae=0),n[0]=Y[ae++],n[1]=Y[ae++],n[2]=Y[ae++],n[3]=Y[ae++]),o=(n[0]|n[1]|n[2]|n[3])===0,s=6);let a;typeof e=="string"?(!t.mask||o)&&t[A]!==void 0?a=t[A]:(e=Buffer.from(e),a=e.length):(a=e.length,r=t.mask&&t.readOnly&&!o);let l=a;a>=65536?(s+=8,l=127):a>125&&(s+=2,l=126);let c=Buffer.allocUnsafe(r?a+s:s);return c[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(c[0]|=64),c[1]=l,l===126?c.writeUInt16BE(a,2):l===127&&(c[2]=c[3]=0,c.writeUIntBE(a,4,6)),t.mask?(c[1]|=128,c[s-4]=n[0],c[s-3]=n[1],c[s-2]=n[2],c[s-1]=n[3],o?[c,e]:r?(Pn(e,n,c,s,a),[c]):(Pn(e,n,e,0,a),[c,e])):[c,e]}close(e,t,n,r){let s;if(e===void 0)s=Os;else{if(typeof e!="number"||!Is(e))throw new TypeError("First argument must be a valid error code number");if(t===void 0||!t.length)s=Buffer.allocUnsafe(2),s.writeUInt16BE(e,0);else{let a=Buffer.byteLength(t);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");s=Buffer.allocUnsafe(2+a),s.writeUInt16BE(e,0),typeof t=="string"?s.write(t,2):s.set(t,2)}}let o={[A]:s.length,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._state!==M?this.enqueue([this.dispatch,s,!1,o,r]):this.sendFrame(i.frame(s,o),r)}ping(e,t,n){let r,s;if(typeof e=="string"?(r=Buffer.byteLength(e),s=!1):oe(e)?(r=e.size,s=!1):(e=z(e),r=e.length,s=z.readOnly),r>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[A]:r,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:s,rsv1:!1};oe(e)?this._state!==M?this.enqueue([this.getBlobData,e,!1,o,n]):this.getBlobData(e,!1,o,n):this._state!==M?this.enqueue([this.dispatch,e,!1,o,n]):this.sendFrame(i.frame(e,o),n)}pong(e,t,n){let r,s;if(typeof e=="string"?(r=Buffer.byteLength(e),s=!1):oe(e)?(r=e.size,s=!1):(e=z(e),r=e.length,s=z.readOnly),r>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[A]:r,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:s,rsv1:!1};oe(e)?this._state!==M?this.enqueue([this.getBlobData,e,!1,o,n]):this.getBlobData(e,!1,o,n):this._state!==M?this.enqueue([this.dispatch,e,!1,o,n]):this.sendFrame(i.frame(e,o),n)}send(e,t,n){let r=this._extensions[Tn.extensionName],s=t.binary?2:1,o=t.compress,a,l;typeof e=="string"?(a=Buffer.byteLength(e),l=!1):oe(e)?(a=e.size,l=!1):(e=z(e),a=e.length,l=z.readOnly),this._firstFragment?(this._firstFragment=!1,o&&r&&r.params[r._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(o=a>=r._threshold),this._compress=o):(o=!1,s=0),t.fin&&(this._firstFragment=!0);let c={[A]:a,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:s,readOnly:l,rsv1:o};oe(e)?this._state!==M?this.enqueue([this.getBlobData,e,this._compress,c,n]):this.getBlobData(e,this._compress,c,n):this._state!==M?this.enqueue([this.dispatch,e,this._compress,c,n]):this.dispatch(e,this._compress,c,n)}getBlobData(e,t,n,r){this._bufferedBytes+=n[A],this._state=Bs,e.arrayBuffer().then(s=>{if(this._socket.destroyed){let a=new Error("The socket was closed while the blob was being read");process.nextTick(Bt,this,a,r);return}this._bufferedBytes-=n[A];let o=z(s);t?this.dispatch(o,t,n,r):(this._state=M,this.sendFrame(i.frame(o,n),r),this.dequeue())}).catch(s=>{process.nextTick(Ls,this,s,r)})}dispatch(e,t,n,r){if(!t){this.sendFrame(i.frame(e,n),r);return}let s=this._extensions[Tn.extensionName];this._bufferedBytes+=n[A],this._state=Ps,s.compress(e,n.fin,(o,a)=>{if(this._socket.destroyed){let l=new Error("The socket was closed while data was being compressed");Bt(this,l,r);return}this._bufferedBytes-=n[A],this._state=M,n.readOnly=!1,this.sendFrame(i.frame(a,n),r),this.dequeue()})}dequeue(){for(;this._state===M&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][A],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][A],this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}};Bn.exports=Pt;function Bt(i,e,t){typeof t=="function"&&t(e);for(let n=0;n<i._queue.length;n++){let r=i._queue[n],s=r[r.length-1];typeof s=="function"&&s(e)}}function Ls(i,e,t){Bt(i,e,t),i.onerror(e)}});var qn=v((tl,$n)=>{"use strict";var{kForOnEventAttribute:Ce,kListener:Rt}=T(),Ln=Symbol("kCode"),Rn=Symbol("kData"),Un=Symbol("kError"),Wn=Symbol("kMessage"),jn=Symbol("kReason"),le=Symbol("kTarget"),Gn=Symbol("kType"),Hn=Symbol("kWasClean"),L=class{constructor(e){this[le]=null,this[Gn]=e}get target(){return this[le]}get type(){return this[Gn]}};Object.defineProperty(L.prototype,"target",{enumerable:!0});Object.defineProperty(L.prototype,"type",{enumerable:!0});var K=class extends L{constructor(e,t={}){super(e),this[Ln]=t.code===void 0?0:t.code,this[jn]=t.reason===void 0?"":t.reason,this[Hn]=t.wasClean===void 0?!1:t.wasClean}get code(){return this[Ln]}get reason(){return this[jn]}get wasClean(){return this[Hn]}};Object.defineProperty(K.prototype,"code",{enumerable:!0});Object.defineProperty(K.prototype,"reason",{enumerable:!0});Object.defineProperty(K.prototype,"wasClean",{enumerable:!0});var ce=class extends L{constructor(e,t={}){super(e),this[Un]=t.error===void 0?null:t.error,this[Wn]=t.message===void 0?"":t.message}get error(){return this[Un]}get message(){return this[Wn]}};Object.defineProperty(ce.prototype,"error",{enumerable:!0});Object.defineProperty(ce.prototype,"message",{enumerable:!0});var Ee=class extends L{constructor(e,t={}){super(e),this[Rn]=t.data===void 0?null:t.data}get data(){return this[Rn]}};Object.defineProperty(Ee.prototype,"data",{enumerable:!0});var Rs={addEventListener(i,e,t={}){for(let r of this.listeners(i))if(!t[Ce]&&r[Rt]===e&&!r[Ce])return;let n;if(i==="message")n=function(s,o){let a=new Ee("message",{data:o?s:s.toString()});a[le]=this,Ye(e,this,a)};else if(i==="close")n=function(s,o){let a=new K("close",{code:s,reason:o.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[le]=this,Ye(e,this,a)};else if(i==="error")n=function(s){let o=new ce("error",{error:s,message:s.message});o[le]=this,Ye(e,this,o)};else if(i==="open")n=function(){let s=new L("open");s[le]=this,Ye(e,this,s)};else return;n[Ce]=!!t[Ce],n[Rt]=e,t.once?this.once(i,n):this.on(i,n)},removeEventListener(i,e){for(let t of this.listeners(i))if(t[Rt]===e&&!t[Ce]){this.removeListener(i,t);break}}};$n.exports={CloseEvent:K,ErrorEvent:ce,Event:L,EventTarget:Rs,MessageEvent:Ee};function Ye(i,e,t){typeof i=="object"&&i.handleEvent?i.handleEvent.call(i,t):i.call(e,t)}});var Ut=v((il,zn)=>{"use strict";var{tokenChars:Se}=se();function N(i,e,t){i[e]===void 0?i[e]=[t]:i[e].push(t)}function Us(i){let e=Object.create(null),t=Object.create(null),n=!1,r=!1,s=!1,o,a,l=-1,c=-1,u=-1,h=0;for(;h<i.length;h++)if(c=i.charCodeAt(h),o===void 0)if(u===-1&&Se[c]===1)l===-1&&(l=h);else if(h!==0&&(c===32||c===9))u===-1&&l!==-1&&(u=h);else if(c===59||c===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${h}`);u===-1&&(u=h);let _=i.slice(l,u);c===44?(N(e,_,t),t=Object.create(null)):o=_,l=u=-1}else throw new SyntaxError(`Unexpected character at index ${h}`);else if(a===void 0)if(u===-1&&Se[c]===1)l===-1&&(l=h);else if(c===32||c===9)u===-1&&l!==-1&&(u=h);else if(c===59||c===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${h}`);u===-1&&(u=h),N(t,i.slice(l,u),!0),c===44&&(N(e,o,t),t=Object.create(null),o=void 0),l=u=-1}else if(c===61&&l!==-1&&u===-1)a=i.slice(l,h),l=u=-1;else throw new SyntaxError(`Unexpected character at index ${h}`);else if(r){if(Se[c]!==1)throw new SyntaxError(`Unexpected character at index ${h}`);l===-1?l=h:n||(n=!0),r=!1}else if(s)if(Se[c]===1)l===-1&&(l=h);else if(c===34&&l!==-1)s=!1,u=h;else if(c===92)r=!0;else throw new SyntaxError(`Unexpected character at index ${h}`);else if(c===34&&i.charCodeAt(h-1)===61)s=!0;else if(u===-1&&Se[c]===1)l===-1&&(l=h);else if(l!==-1&&(c===32||c===9))u===-1&&(u=h);else if(c===59||c===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${h}`);u===-1&&(u=h);let _=i.slice(l,u);n&&(_=_.replace(/\\/g,""),n=!1),N(t,a,_),c===44&&(N(e,o,t),t=Object.create(null),o=void 0),a=void 0,l=u=-1}else throw new SyntaxError(`Unexpected character at index ${h}`);if(l===-1||s||c===32||c===9)throw new SyntaxError("Unexpected end of input");u===-1&&(u=h);let f=i.slice(l,u);return o===void 0?N(e,f,t):(a===void 0?N(t,f,!0):n?N(t,a,f.replace(/\\/g,"")):N(t,a,f),N(e,o,t)),e}function Ws(i){return Object.keys(i).map(e=>{let t=i[e];return Array.isArray(t)||(t=[t]),t.map(n=>[e].concat(Object.keys(n).map(r=>{let s=n[r];return Array.isArray(s)||(s=[s]),s.map(o=>o===!0?r:`${r}=${o}`).join("; ")})).join("; ")).join(", ")}).join(", ")}zn.exports={format:Ws,parse:Us}});var $t=v((sl,sr)=>{"use strict";var js=p("events"),Gs=p("https"),Hs=p("http"),Zn=p("net"),$s=p("tls"),{randomBytes:qs,createHash:zs}=p("crypto"),{Duplex:nl,Readable:rl}=p("stream"),{URL:Wt}=p("url"),H=be(),Ys=Tt(),Ks=Lt(),{isBlob:Zs}=se(),{BINARY_TYPES:Yn,EMPTY_BUFFER:Ke,GUID:Xs,kForOnEventAttribute:jt,kListener:Js,kStatusCode:Qs,kWebSocket:C,NOOP:Xn}=T(),{EventTarget:{addEventListener:eo,removeEventListener:to}}=qn(),{format:io,parse:no}=Ut(),{toBuffer:ro}=_e(),so=30*1e3,Jn=Symbol("kAborted"),Gt=[8,13],R=["CONNECTING","OPEN","CLOSING","CLOSED"],oo=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,g=class i extends js{constructor(e,t,n){super(),this._binaryType=Yn[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Ke,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=i.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,t===void 0?t=[]:Array.isArray(t)||(typeof t=="object"&&t!==null?(n=t,t=[]):t=[t]),Qn(this,e,t,n)):(this._autoPong=n.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){Yn.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,n){let r=new Ys({allowSynchronousEvents:n.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation}),s=new Ks(e,this._extensions,n.generateMask);this._receiver=r,this._sender=s,this._socket=e,r[C]=this,s[C]=this,e[C]=this,r.on("conclude",co),r.on("drain",uo),r.on("error",ho),r.on("message",fo),r.on("ping",po),r.on("pong",mo),s.onerror=go,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",ir),e.on("data",Xe),e.on("end",nr),e.on("error",rr),this._readyState=i.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=i.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[H.extensionName]&&this._extensions[H.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=i.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==i.CLOSED){if(this.readyState===i.CONNECTING){V(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===i.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=i.CLOSING,this._sender.close(e,t,!this._isServer,n=>{n||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),tr(this)}}pause(){this.readyState===i.CONNECTING||this.readyState===i.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,t,n){if(this.readyState===i.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=t=void 0):typeof t=="function"&&(n=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==i.OPEN){Ht(this,e,n);return}t===void 0&&(t=!this._isServer),this._sender.ping(e||Ke,t,n)}pong(e,t,n){if(this.readyState===i.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=t=void 0):typeof t=="function"&&(n=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==i.OPEN){Ht(this,e,n);return}t===void 0&&(t=!this._isServer),this._sender.pong(e||Ke,t,n)}resume(){this.readyState===i.CONNECTING||this.readyState===i.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,n){if(this.readyState===i.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"&&(n=t,t={}),typeof e=="number"&&(e=e.toString()),this.readyState!==i.OPEN){Ht(this,e,n);return}let r=y({binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0},t);this._extensions[H.extensionName]||(r.compress=!1),this._sender.send(e||Ke,r,n)}terminate(){if(this.readyState!==i.CLOSED){if(this.readyState===i.CONNECTING){V(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=i.CLOSING,this._socket.destroy())}}};Object.defineProperty(g,"CONNECTING",{enumerable:!0,value:R.indexOf("CONNECTING")});Object.defineProperty(g.prototype,"CONNECTING",{enumerable:!0,value:R.indexOf("CONNECTING")});Object.defineProperty(g,"OPEN",{enumerable:!0,value:R.indexOf("OPEN")});Object.defineProperty(g.prototype,"OPEN",{enumerable:!0,value:R.indexOf("OPEN")});Object.defineProperty(g,"CLOSING",{enumerable:!0,value:R.indexOf("CLOSING")});Object.defineProperty(g.prototype,"CLOSING",{enumerable:!0,value:R.indexOf("CLOSING")});Object.defineProperty(g,"CLOSED",{enumerable:!0,value:R.indexOf("CLOSED")});Object.defineProperty(g.prototype,"CLOSED",{enumerable:!0,value:R.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(i=>{Object.defineProperty(g.prototype,i,{enumerable:!0})});["open","error","close","message"].forEach(i=>{Object.defineProperty(g.prototype,`on${i}`,{enumerable:!0,get(){for(let e of this.listeners(i))if(e[jt])return e[Js];return null},set(e){for(let t of this.listeners(i))if(t[jt]){this.removeListener(i,t);break}typeof e=="function"&&this.addEventListener(i,e,{[jt]:!0})}})});g.prototype.addEventListener=eo;g.prototype.removeEventListener=to;sr.exports=g;function Qn(i,e,t,n){let r=S(y({allowSynchronousEvents:!0,autoPong:!0,protocolVersion:Gt[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10},n),{socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0});if(i._autoPong=r.autoPong,!Gt.includes(r.protocolVersion))throw new RangeError(`Unsupported protocol version: ${r.protocolVersion} (supported versions: ${Gt.join(", ")})`);let s;if(e instanceof Wt)s=e;else try{s=new Wt(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}s.protocol==="http:"?s.protocol="ws:":s.protocol==="https:"&&(s.protocol="wss:"),i._url=s.href;let o=s.protocol==="wss:",a=s.protocol==="ws+unix:",l;if(s.protocol!=="ws:"&&!o&&!a?l=`The URL's protocol must be one of "ws:", "wss:", "http:", "https", or "ws+unix:"`:a&&!s.pathname?l="The URL's pathname is empty":s.hash&&(l="The URL contains a fragment identifier"),l){let d=new SyntaxError(l);if(i._redirects===0)throw d;Ze(i,d);return}let c=o?443:80,u=qs(16).toString("base64"),h=o?Gs.request:Hs.request,f=new Set,_;if(r.createConnection=r.createConnection||(o?lo:ao),r.defaultPort=r.defaultPort||c,r.port=s.port||c,r.host=s.hostname.startsWith("[")?s.hostname.slice(1,-1):s.hostname,r.headers=S(y({},r.headers),{"Sec-WebSocket-Version":r.protocolVersion,"Sec-WebSocket-Key":u,Connection:"Upgrade",Upgrade:"websocket"}),r.path=s.pathname+s.search,r.timeout=r.handshakeTimeout,r.perMessageDeflate&&(_=new H(r.perMessageDeflate!==!0?r.perMessageDeflate:{},!1,r.maxPayload),r.headers["Sec-WebSocket-Extensions"]=io({[H.extensionName]:_.offer()})),t.length){for(let d of t){if(typeof d!="string"||!oo.test(d)||f.has(d))throw new SyntaxError("An invalid or duplicated subprotocol was specified");f.add(d)}r.headers["Sec-WebSocket-Protocol"]=t.join(",")}if(r.origin&&(r.protocolVersion<13?r.headers["Sec-WebSocket-Origin"]=r.origin:r.headers.Origin=r.origin),(s.username||s.password)&&(r.auth=`${s.username}:${s.password}`),a){let d=r.path.split(":");r.socketPath=d[0],r.path=d[1]}let m;if(r.followRedirects){if(i._redirects===0){i._originalIpc=a,i._originalSecure=o,i._originalHostOrSocketPath=a?r.socketPath:s.host;let d=n&&n.headers;if(n=S(y({},n),{headers:{}}),d)for(let[E,J]of Object.entries(d))n.headers[E.toLowerCase()]=J}else if(i.listenerCount("redirect")===0){let d=a?i._originalIpc?r.socketPath===i._originalHostOrSocketPath:!1:i._originalIpc?!1:s.host===i._originalHostOrSocketPath;(!d||i._originalSecure&&!o)&&(delete r.headers.authorization,delete r.headers.cookie,d||delete r.headers.host,r.auth=void 0)}r.auth&&!n.headers.authorization&&(n.headers.authorization="Basic "+Buffer.from(r.auth).toString("base64")),m=i._req=h(r),i._redirects&&i.emit("redirect",i.url,m)}else m=i._req=h(r);r.timeout&&m.on("timeout",()=>{V(i,m,"Opening handshake has timed out")}),m.on("error",d=>{m===null||m[Jn]||(m=i._req=null,Ze(i,d))}),m.on("response",d=>{let E=d.headers.location,J=d.statusCode;if(E&&r.followRedirects&&J>=300&&J<400){if(++i._redirects>r.maxRedirects){V(i,m,"Maximum redirects exceeded");return}m.abort();let ue;try{ue=new Wt(E,e)}catch{let Q=new SyntaxError(`Invalid URL: ${E}`);Ze(i,Q);return}Qn(i,ue,t,n)}else i.emit("unexpected-response",m,d)||V(i,m,`Unexpected server response: ${d.statusCode}`)}),m.on("upgrade",(d,E,J)=>{if(i.emit("upgrade",d),i.readyState!==g.CONNECTING)return;m=i._req=null;let ue=d.headers.upgrade;if(ue===void 0||ue.toLowerCase()!=="websocket"){V(i,E,"Invalid Upgrade header");return}let zt=zs("sha1").update(u+Xs).digest("base64");if(d.headers["sec-websocket-accept"]!==zt){V(i,E,"Invalid Sec-WebSocket-Accept header");return}let Q=d.headers["sec-websocket-protocol"],he;if(Q!==void 0?f.size?f.has(Q)||(he="Server sent an invalid subprotocol"):he="Server sent a subprotocol but none was requested":f.size&&(he="Server sent no subprotocol"),he){V(i,E,he);return}Q&&(i._protocol=Q);let Yt=d.headers["sec-websocket-extensions"];if(Yt!==void 0){if(!_){V(i,E,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let Qe;try{Qe=no(Yt)}catch{V(i,E,"Invalid Sec-WebSocket-Extensions header");return}let Kt=Object.keys(Qe);if(Kt.length!==1||Kt[0]!==H.extensionName){V(i,E,"Server indicated an extension that was not requested");return}try{_.accept(Qe[H.extensionName])}catch{V(i,E,"Invalid Sec-WebSocket-Extensions header");return}i._extensions[H.extensionName]=_}i.setSocket(E,J,{allowSynchronousEvents:r.allowSynchronousEvents,generateMask:r.generateMask,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation})}),r.finishRequest?r.finishRequest(m,i):m.end()}function Ze(i,e){i._readyState=g.CLOSING,i._errorEmitted=!0,i.emit("error",e),i.emitClose()}function ao(i){return i.path=i.socketPath,Zn.connect(i)}function lo(i){return i.path=void 0,!i.servername&&i.servername!==""&&(i.servername=Zn.isIP(i.host)?"":i.host),$s.connect(i)}function V(i,e,t){i._readyState=g.CLOSING;let n=new Error(t);Error.captureStackTrace(n,V),e.setHeader?(e[Jn]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(Ze,i,n)):(e.destroy(n),e.once("error",i.emit.bind(i,"error")),e.once("close",i.emitClose.bind(i)))}function Ht(i,e,t){if(e){let n=Zs(e)?e.size:ro(e).length;i._socket?i._sender._bufferedBytes+=n:i._bufferedAmount+=n}if(t){let n=new Error(`WebSocket is not open: readyState ${i.readyState} (${R[i.readyState]})`);process.nextTick(t,n)}}function co(i,e){let t=this[C];t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=i,t._socket[C]!==void 0&&(t._socket.removeListener("data",Xe),process.nextTick(er,t._socket),i===1005?t.close():t.close(i,e))}function uo(){let i=this[C];i.isPaused||i._socket.resume()}function ho(i){let e=this[C];e._socket[C]!==void 0&&(e._socket.removeListener("data",Xe),process.nextTick(er,e._socket),e.close(i[Qs])),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",i))}function Kn(){this[C].emitClose()}function fo(i,e){this[C].emit("message",i,e)}function po(i){let e=this[C];e._autoPong&&e.pong(i,!this._isServer,Xn),e.emit("ping",i)}function mo(i){this[C].emit("pong",i)}function er(i){i.resume()}function go(i){let e=this[C];e.readyState!==g.CLOSED&&(e.readyState===g.OPEN&&(e._readyState=g.CLOSING,tr(e)),this._socket.end(),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",i)))}function tr(i){i._closeTimer=setTimeout(i._socket.destroy.bind(i._socket),so)}function ir(){let i=this[C];this.removeListener("close",ir),this.removeListener("data",Xe),this.removeListener("end",nr),i._readyState=g.CLOSING;let e;!this._readableState.endEmitted&&!i._closeFrameReceived&&!i._receiver._writableState.errorEmitted&&(e=i._socket.read())!==null&&i._receiver.write(e),i._receiver.end(),this[C]=void 0,clearTimeout(i._closeTimer),i._receiver._writableState.finished||i._receiver._writableState.errorEmitted?i.emitClose():(i._receiver.on("error",Kn),i._receiver.on("finish",Kn))}function Xe(i){this[C]._receiver.write(i)||this.pause()}function nr(){let i=this[C];i._readyState=g.CLOSING,i._receiver.end(),this.end()}function rr(){let i=this[C];this.removeListener("error",rr),this.on("error",Xn),i&&(i._readyState=g.CLOSING,this.destroy())}});var cr=v((al,lr)=>{"use strict";var{Duplex:_o}=p("stream");function or(i){i.emit("close")}function yo(){!this.destroyed&&this._writableState.finished&&this.destroy()}function ar(i){this.removeListener("error",ar),this.destroy(),this.listenerCount("error")===0&&this.emit("error",i)}function vo(i,e){let t=!0,n=new _o(S(y({},e),{autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1}));return i.on("message",function(s,o){let a=!o&&n._readableState.objectMode?s.toString():s;n.push(a)||i.pause()}),i.once("error",function(s){n.destroyed||(t=!1,n.destroy(s))}),i.once("close",function(){n.destroyed||n.push(null)}),n._destroy=function(r,s){if(i.readyState===i.CLOSED){s(r),process.nextTick(or,n);return}let o=!1;i.once("error",function(l){o=!0,s(l)}),i.once("close",function(){o||s(r),process.nextTick(or,n)}),t&&i.terminate()},n._final=function(r){if(i.readyState===i.CONNECTING){i.once("open",function(){n._final(r)});return}i._socket!==null&&(i._socket._writableState.finished?(r(),n._readableState.endEmitted&&n.destroy()):(i._socket.once("finish",function(){r()}),i.close()))},n._read=function(){i.isPaused&&i.resume()},n._write=function(r,s,o){if(i.readyState===i.CONNECTING){i.once("open",function(){n._write(r,s,o)});return}i.send(r,o)},n.on("end",yo),n.on("error",ar),n}lr.exports=vo});var hr=v((cl,ur)=>{"use strict";var{tokenChars:bo}=se();function Co(i){let e=new Set,t=-1,n=-1,r=0;for(r;r<i.length;r++){let o=i.charCodeAt(r);if(n===-1&&bo[o]===1)t===-1&&(t=r);else if(r!==0&&(o===32||o===9))n===-1&&t!==-1&&(n=r);else if(o===44){if(t===-1)throw new SyntaxError(`Unexpected character at index ${r}`);n===-1&&(n=r);let a=i.slice(t,n);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),t=n=-1}else throw new SyntaxError(`Unexpected character at index ${r}`)}if(t===-1||n!==-1)throw new SyntaxError("Unexpected end of input");let s=i.slice(t,r);if(e.has(s))throw new SyntaxError(`The "${s}" subprotocol is duplicated`);return e.add(s),e}ur.exports={parse:Co}});var yr=v((hl,_r)=>{"use strict";var Eo=p("events"),Je=p("http"),{Duplex:ul}=p("stream"),{createHash:So}=p("crypto"),dr=Ut(),Z=be(),wo=hr(),xo=$t(),{GUID:Vo,kWebSocket:Do}=T(),Ao=/^[+/0-9A-Za-z]{22}==$/,fr=0,pr=1,gr=2,qt=class extends Eo{constructor(e,t){if(super(),e=y({allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:xo},e),e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=Je.createServer((n,r)=>{let s=Je.STATUS_CODES[426];r.writeHead(426,{"Content-Length":s.length,"Content-Type":"text/plain"}),r.end(s)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){let n=this.emit.bind(this,"connection");this._removeListeners=ko(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(r,s,o)=>{this.handleUpgrade(r,s,o,n)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=fr}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===gr){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(we,this);return}if(e&&this.once("close",e),this._state!==pr)if(this._state=pr,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(we,this):process.nextTick(we,this);else{let t=this._server;this._removeListeners(),this._removeListeners=this._server=null,t.close(()=>{we(this)})}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,n,r){t.on("error",mr);let s=e.headers["sec-websocket-key"],o=e.headers.upgrade,a=+e.headers["sec-websocket-version"];if(e.method!=="GET"){X(this,e,t,405,"Invalid HTTP method");return}if(o===void 0||o.toLowerCase()!=="websocket"){X(this,e,t,400,"Invalid Upgrade header");return}if(s===void 0||!Ao.test(s)){X(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");return}if(a!==8&&a!==13){X(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(e)){xe(t,400);return}let l=e.headers["sec-websocket-protocol"],c=new Set;if(l!==void 0)try{c=wo.parse(l)}catch{X(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let u=e.headers["sec-websocket-extensions"],h={};if(this.options.perMessageDeflate&&u!==void 0){let f=new Z(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let _=dr.parse(u);_[Z.extensionName]&&(f.accept(_[Z.extensionName]),h[Z.extensionName]=f)}catch{X(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let f={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(f,(_,m,d,E)=>{if(!_)return xe(t,m||401,d,E);this.completeUpgrade(h,s,c,e,t,n,r)});return}if(!this.options.verifyClient(f))return xe(t,401)}this.completeUpgrade(h,s,c,e,t,n,r)}completeUpgrade(e,t,n,r,s,o,a){if(!s.readable||!s.writable)return s.destroy();if(s[Do])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>fr)return xe(s,503);let c=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${So("sha1").update(t+Vo).digest("base64")}`],u=new this.options.WebSocket(null,void 0,this.options);if(n.size){let h=this.options.handleProtocols?this.options.handleProtocols(n,r):n.values().next().value;h&&(c.push(`Sec-WebSocket-Protocol: ${h}`),u._protocol=h)}if(e[Z.extensionName]){let h=e[Z.extensionName].params,f=dr.format({[Z.extensionName]:[h]});c.push(`Sec-WebSocket-Extensions: ${f}`),u._extensions=e}this.emit("headers",c,r),s.write(c.concat(`\r
`).join(`\r
`)),s.removeListener("error",mr),u.setSocket(s,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(u),u.on("close",()=>{this.clients.delete(u),this._shouldEmitClose&&!this.clients.size&&process.nextTick(we,this)})),a(u,r)}};_r.exports=qt;function ko(i,e){for(let t of Object.keys(e))i.on(t,e[t]);return function(){for(let n of Object.keys(e))i.removeListener(n,e[n])}}function we(i){i._state=gr,i.emit("close")}function mr(){this.destroy()}function xe(i,e,t,n){t=t||Je.STATUS_CODES[e],n=y({Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(t)},n),i.once("finish",i.destroy),i.end(`HTTP/1.1 ${e} ${Je.STATUS_CODES[e]}\r
`+Object.keys(n).map(r=>`${r}: ${n[r]}`).join(`\r
`)+`\r
\r
`+t)}function X(i,e,t,n,r){if(i.listenerCount("wsClientError")){let s=new Error(r);Error.captureStackTrace(s,X),i.emit("wsClientError",s,t,e)}else xe(t,n,r)}});var br=v((fl,vr)=>{"use strict";var U=$t();U.createWebSocketStream=cr();U.Server=yr();U.Receiver=Tt();U.Sender=Lt();U.WebSocket=U;U.WebSocketServer=U.Server;vr.exports=U});var Ci=(()=>{class i{constructor(){this.name={name:""}}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=De({type:i,selectors:[["app-sockettest"]],decls:6,vars:2,consts:[["type","text","name","name","id",""]],template:function(n,r){n&1&&(W(0,"p"),ie(1),j(),ke(2,"input",0),W(3,"div")(4,"li"),ie(5),j()()),n&2&&($(),ai(r.name),$(4),li(" ",r.name.name," "))}})}}return i})();var Er=[{path:"",redirectTo:"",pathMatch:"full"},{path:"socket",component:Ci}],Ei=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=I({type:i})}static{this.\u0275inj=F({imports:[lt.forRoot(Er),lt]})}}return i})();var q={LF:`
`,NULL:"\0"};var fe=class i{constructor(e){let{command:t,headers:n,body:r,binaryBody:s,escapeHeaderValues:o,skipContentLengthHeader:a}=e;this.command=t,this.headers=Object.assign({},n||{}),s?(this._binaryBody=s,this.isBinaryBody=!0):(this._body=r||"",this.isBinaryBody=!1),this.escapeHeaderValues=o||!1,this.skipContentLengthHeader=a||!1}get body(){return!this._body&&this.isBinaryBody&&(this._body=new TextDecoder().decode(this._binaryBody)),this._body||""}get binaryBody(){return!this._binaryBody&&!this.isBinaryBody&&(this._binaryBody=new TextEncoder().encode(this._body)),this._binaryBody}static fromRawFrame(e,t){let n={},r=s=>s.replace(/^\s+|\s+$/g,"");for(let s of e.headers.reverse()){let o=s.indexOf(":"),a=r(s[0]),l=r(s[1]);t&&e.command!=="CONNECT"&&e.command!=="CONNECTED"&&(l=i.hdrValueUnEscape(l)),n[a]=l}return new i({command:e.command,headers:n,binaryBody:e.binaryBody,escapeHeaderValues:t})}toString(){return this.serializeCmdAndHeaders()}serialize(){let e=this.serializeCmdAndHeaders();return this.isBinaryBody?i.toUnit8Array(e,this._binaryBody).buffer:e+this._body+q.NULL}serializeCmdAndHeaders(){let e=[this.command];this.skipContentLengthHeader&&delete this.headers["content-length"];for(let t of Object.keys(this.headers||{})){let n=this.headers[t];this.escapeHeaderValues&&this.command!=="CONNECT"&&this.command!=="CONNECTED"?e.push(`${t}:${i.hdrValueEscape(`${n}`)}`):e.push(`${t}:${n}`)}return(this.isBinaryBody||!this.isBodyEmpty()&&!this.skipContentLengthHeader)&&e.push(`content-length:${this.bodyLength()}`),e.join(q.LF)+q.LF+q.LF}isBodyEmpty(){return this.bodyLength()===0}bodyLength(){let e=this.binaryBody;return e?e.length:0}static sizeOfUTF8(e){return e?new TextEncoder().encode(e).length:0}static toUnit8Array(e,t){let n=new TextEncoder().encode(e),r=new Uint8Array([0]),s=new Uint8Array(n.length+t.length+r.length);return s.set(n),s.set(t,n.length),s.set(r,n.length+t.length),s}static marshall(e){return new i(e).serialize()}static hdrValueEscape(e){return e.replace(/\\/g,"\\\\").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/:/g,"\\c")}static hdrValueUnEscape(e){return e.replace(/\\r/g,"\r").replace(/\\n/g,`
`).replace(/\\c/g,":").replace(/\\\\/g,"\\")}};var Oe=class{constructor(e,t){this.onFrame=e,this.onIncomingPing=t,this._encoder=new TextEncoder,this._decoder=new TextDecoder,this._token=[],this._initState()}parseChunk(e,t=!1){let n;if(typeof e=="string"?n=this._encoder.encode(e):n=new Uint8Array(e),t&&n[n.length-1]!==0){let r=new Uint8Array(n.length+1);r.set(n,0),r[n.length]=0,n=r}for(let r=0;r<n.length;r++){let s=n[r];this._onByte(s)}}_collectFrame(e){if(e!==0&&e!==13){if(e===10){this.onIncomingPing();return}this._onByte=this._collectCommand,this._reinjectByte(e)}}_collectCommand(e){if(e!==13){if(e===10){this._results.command=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaders;return}this._consumeByte(e)}}_collectHeaders(e){if(e!==13){if(e===10){this._setupCollectBody();return}this._onByte=this._collectHeaderKey,this._reinjectByte(e)}}_reinjectByte(e){this._onByte(e)}_collectHeaderKey(e){if(e===58){this._headerKey=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaderValue;return}this._consumeByte(e)}_collectHeaderValue(e){if(e!==13){if(e===10){this._results.headers.push([this._headerKey,this._consumeTokenAsUTF8()]),this._headerKey=void 0,this._onByte=this._collectHeaders;return}this._consumeByte(e)}}_setupCollectBody(){let e=this._results.headers.filter(t=>t[0]==="content-length")[0];e?(this._bodyBytesRemaining=parseInt(e[1],10),this._onByte=this._collectBodyFixedSize):this._onByte=this._collectBodyNullTerminated}_collectBodyNullTerminated(e){if(e===0){this._retrievedBody();return}this._consumeByte(e)}_collectBodyFixedSize(e){if(this._bodyBytesRemaining--===0){this._retrievedBody();return}this._consumeByte(e)}_retrievedBody(){this._results.binaryBody=this._consumeTokenAsRaw();try{this.onFrame(this._results)}catch(e){console.log("Ignoring an exception thrown by a frame handler. Original exception: ",e)}this._initState()}_consumeByte(e){this._token.push(e)}_consumeTokenAsUTF8(){return this._decoder.decode(this._consumeTokenAsRaw())}_consumeTokenAsRaw(){let e=new Uint8Array(this._token);return this._token=[],e}_initState(){this._results={command:void 0,headers:[],binaryBody:void 0},this._token=[],this._headerKey=void 0,this._onByte=this._collectFrame}};var k;(function(i){i[i.CONNECTING=0]="CONNECTING",i[i.OPEN=1]="OPEN",i[i.CLOSING=2]="CLOSING",i[i.CLOSED=3]="CLOSED"})(k=k||(k={}));var x;(function(i){i[i.ACTIVE=0]="ACTIVE",i[i.DEACTIVATING=1]="DEACTIVATING",i[i.INACTIVE=2]="INACTIVE"})(x=x||(x={}));var b=class{constructor(e){this.versions=e}supportedVersions(){return this.versions.join(",")}protocolVersions(){return this.versions.map(e=>`v${e.replace(".","")}.stomp`)}};b.V1_0="1.0";b.V1_1="1.1";b.V1_2="1.2";b.default=new b([b.V1_2,b.V1_1,b.V1_0]);function Si(i,e){i.terminate=function(){let t=()=>{};this.onerror=t,this.onmessage=t,this.onopen=t;let n=new Date,r=Math.random().toString().substring(2,8),s=this.onclose;this.onclose=o=>{let a=new Date().getTime()-n.getTime();e(`Discarded socket (#${r})  closed after ${a}ms, with code/reason: ${o.code}/${o.reason}`)},this.close(),s?.call(i,{code:4001,reason:`Quick discarding socket (#${r}) without waiting for the shutdown sequence.`,wasClean:!1})}}var Ne=class{constructor(e,t,n){this._client=e,this._webSocket=t,this._connected=!1,this._serverFrameHandlers={CONNECTED:r=>{this.debug(`connected to server ${r.headers.server}`),this._connected=!0,this._connectedVersion=r.headers.version,this._connectedVersion===b.V1_2&&(this._escapeHeaderValues=!0),this._setupHeartbeat(r.headers),this.onConnect(r)},MESSAGE:r=>{let s=r.headers.subscription,o=this._subscriptions[s]||this.onUnhandledMessage,a=r,l=this,c=this._connectedVersion===b.V1_2?a.headers.ack:a.headers["message-id"];a.ack=(u={})=>l.ack(c,s,u),a.nack=(u={})=>l.nack(c,s,u),o(a)},RECEIPT:r=>{let s=this._receiptWatchers[r.headers["receipt-id"]];s?(s(r),delete this._receiptWatchers[r.headers["receipt-id"]]):this.onUnhandledReceipt(r)},ERROR:r=>{this.onStompError(r)}},this._counter=0,this._subscriptions={},this._receiptWatchers={},this._partialData="",this._escapeHeaderValues=!1,this._lastServerActivityTS=Date.now(),this.debug=n.debug,this.stompVersions=n.stompVersions,this.connectHeaders=n.connectHeaders,this.disconnectHeaders=n.disconnectHeaders,this.heartbeatIncoming=n.heartbeatIncoming,this.heartbeatOutgoing=n.heartbeatOutgoing,this.splitLargeFrames=n.splitLargeFrames,this.maxWebSocketChunkSize=n.maxWebSocketChunkSize,this.forceBinaryWSFrames=n.forceBinaryWSFrames,this.logRawCommunication=n.logRawCommunication,this.appendMissingNULLonIncoming=n.appendMissingNULLonIncoming,this.discardWebsocketOnCommFailure=n.discardWebsocketOnCommFailure,this.onConnect=n.onConnect,this.onDisconnect=n.onDisconnect,this.onStompError=n.onStompError,this.onWebSocketClose=n.onWebSocketClose,this.onWebSocketError=n.onWebSocketError,this.onUnhandledMessage=n.onUnhandledMessage,this.onUnhandledReceipt=n.onUnhandledReceipt,this.onUnhandledFrame=n.onUnhandledFrame}get connectedVersion(){return this._connectedVersion}get connected(){return this._connected}start(){let e=new Oe(t=>{let n=fe.fromRawFrame(t,this._escapeHeaderValues);this.logRawCommunication||this.debug(`<<< ${n}`),(this._serverFrameHandlers[n.command]||this.onUnhandledFrame)(n)},()=>{this.debug("<<< PONG")});this._webSocket.onmessage=t=>{if(this.debug("Received data"),this._lastServerActivityTS=Date.now(),this.logRawCommunication){let n=t.data instanceof ArrayBuffer?new TextDecoder().decode(t.data):t.data;this.debug(`<<< ${n}`)}e.parseChunk(t.data,this.appendMissingNULLonIncoming)},this._webSocket.onclose=t=>{this.debug(`Connection closed to ${this._webSocket.url}`),this._cleanUp(),this.onWebSocketClose(t)},this._webSocket.onerror=t=>{this.onWebSocketError(t)},this._webSocket.onopen=()=>{let t=Object.assign({},this.connectHeaders);this.debug("Web Socket Opened..."),t["accept-version"]=this.stompVersions.supportedVersions(),t["heart-beat"]=[this.heartbeatOutgoing,this.heartbeatIncoming].join(","),this._transmit({command:"CONNECT",headers:t})}}_setupHeartbeat(e){if(e.version!==b.V1_1&&e.version!==b.V1_2||!e["heart-beat"])return;let[t,n]=e["heart-beat"].split(",").map(r=>parseInt(r,10));if(this.heartbeatOutgoing!==0&&n!==0){let r=Math.max(this.heartbeatOutgoing,n);this.debug(`send PING every ${r}ms`),this._pinger=setInterval(()=>{this._webSocket.readyState===k.OPEN&&(this._webSocket.send(q.LF),this.debug(">>> PING"))},r)}if(this.heartbeatIncoming!==0&&t!==0){let r=Math.max(this.heartbeatIncoming,t);this.debug(`check PONG every ${r}ms`),this._ponger=setInterval(()=>{let s=Date.now()-this._lastServerActivityTS;s>r*2&&(this.debug(`did not receive server activity for the last ${s}ms`),this._closeOrDiscardWebsocket())},r)}}_closeOrDiscardWebsocket(){this.discardWebsocketOnCommFailure?(this.debug("Discarding websocket, the underlying socket may linger for a while"),this.discardWebsocket()):(this.debug("Issuing close on the websocket"),this._closeWebsocket())}forceDisconnect(){this._webSocket&&(this._webSocket.readyState===k.CONNECTING||this._webSocket.readyState===k.OPEN)&&this._closeOrDiscardWebsocket()}_closeWebsocket(){this._webSocket.onmessage=()=>{},this._webSocket.close()}discardWebsocket(){typeof this._webSocket.terminate!="function"&&Si(this._webSocket,e=>this.debug(e)),this._webSocket.terminate()}_transmit(e){let{command:t,headers:n,body:r,binaryBody:s,skipContentLengthHeader:o}=e,a=new fe({command:t,headers:n,body:r,binaryBody:s,escapeHeaderValues:this._escapeHeaderValues,skipContentLengthHeader:o}),l=a.serialize();if(this.logRawCommunication?this.debug(`>>> ${l}`):this.debug(`>>> ${a}`),this.forceBinaryWSFrames&&typeof l=="string"&&(l=new TextEncoder().encode(l)),typeof l!="string"||!this.splitLargeFrames)this._webSocket.send(l);else{let c=l;for(;c.length>0;){let u=c.substring(0,this.maxWebSocketChunkSize);c=c.substring(this.maxWebSocketChunkSize),this._webSocket.send(u),this.debug(`chunk sent = ${u.length}, remaining = ${c.length}`)}}}dispose(){if(this.connected)try{let e=Object.assign({},this.disconnectHeaders);e.receipt||(e.receipt=`close-${this._counter++}`),this.watchForReceipt(e.receipt,t=>{this._closeWebsocket(),this._cleanUp(),this.onDisconnect(t)}),this._transmit({command:"DISCONNECT",headers:e})}catch(e){this.debug(`Ignoring error during disconnect ${e}`)}else(this._webSocket.readyState===k.CONNECTING||this._webSocket.readyState===k.OPEN)&&this._closeWebsocket()}_cleanUp(){this._connected=!1,this._pinger&&(clearInterval(this._pinger),this._pinger=void 0),this._ponger&&(clearInterval(this._ponger),this._ponger=void 0)}publish(e){let{destination:t,headers:n,body:r,binaryBody:s,skipContentLengthHeader:o}=e,a=Object.assign({destination:t},n);this._transmit({command:"SEND",headers:a,body:r,binaryBody:s,skipContentLengthHeader:o})}watchForReceipt(e,t){this._receiptWatchers[e]=t}subscribe(e,t,n={}){n=Object.assign({},n),n.id||(n.id=`sub-${this._counter++}`),n.destination=e,this._subscriptions[n.id]=t,this._transmit({command:"SUBSCRIBE",headers:n});let r=this;return{id:n.id,unsubscribe(s){return r.unsubscribe(n.id,s)}}}unsubscribe(e,t={}){t=Object.assign({},t),delete this._subscriptions[e],t.id=e,this._transmit({command:"UNSUBSCRIBE",headers:t})}begin(e){let t=e||`tx-${this._counter++}`;this._transmit({command:"BEGIN",headers:{transaction:t}});let n=this;return{id:t,commit(){n.commit(t)},abort(){n.abort(t)}}}commit(e){this._transmit({command:"COMMIT",headers:{transaction:e}})}abort(e){this._transmit({command:"ABORT",headers:{transaction:e}})}ack(e,t,n={}){n=Object.assign({},n),this._connectedVersion===b.V1_2?n.id=e:n["message-id"]=e,n.subscription=t,this._transmit({command:"ACK",headers:n})}nack(e,t,n={}){return n=Object.assign({},n),this._connectedVersion===b.V1_2?n.id=e:n["message-id"]=e,n.subscription=t,this._transmit({command:"NACK",headers:n})}};var Fe=class{constructor(e={}){this.stompVersions=b.default,this.connectionTimeout=0,this.reconnectDelay=5e3,this.heartbeatIncoming=1e4,this.heartbeatOutgoing=1e4,this.splitLargeFrames=!1,this.maxWebSocketChunkSize=8*1024,this.forceBinaryWSFrames=!1,this.appendMissingNULLonIncoming=!1,this.discardWebsocketOnCommFailure=!1,this.state=x.INACTIVE;let t=()=>{};this.debug=t,this.beforeConnect=t,this.onConnect=t,this.onDisconnect=t,this.onUnhandledMessage=t,this.onUnhandledReceipt=t,this.onUnhandledFrame=t,this.onStompError=t,this.onWebSocketClose=t,this.onWebSocketError=t,this.logRawCommunication=!1,this.onChangeState=t,this.connectHeaders={},this._disconnectHeaders={},this.configure(e)}get webSocket(){return this._stompHandler?._webSocket}get disconnectHeaders(){return this._disconnectHeaders}set disconnectHeaders(e){this._disconnectHeaders=e,this._stompHandler&&(this._stompHandler.disconnectHeaders=this._disconnectHeaders)}get connected(){return!!this._stompHandler&&this._stompHandler.connected}get connectedVersion(){return this._stompHandler?this._stompHandler.connectedVersion:void 0}get active(){return this.state===x.ACTIVE}_changeState(e){this.state=e,this.onChangeState(e)}configure(e){Object.assign(this,e)}activate(){let e=()=>{if(this.active){this.debug("Already ACTIVE, ignoring request to activate");return}this._changeState(x.ACTIVE),this._connect()};this.state===x.DEACTIVATING?(this.debug("Waiting for deactivation to finish before activating"),this.deactivate().then(()=>{e()})):e()}_connect(){return tt(this,null,function*(){if(yield this.beforeConnect(),this._stompHandler){this.debug("There is already a stompHandler, skipping the call to connect");return}if(!this.active){this.debug("Client has been marked inactive, will not attempt to connect");return}this.connectionTimeout>0&&(this._connectionWatcher&&clearTimeout(this._connectionWatcher),this._connectionWatcher=setTimeout(()=>{this.connected||(this.debug(`Connection not established in ${this.connectionTimeout}ms, closing socket`),this.forceDisconnect())},this.connectionTimeout)),this.debug("Opening Web Socket...");let e=this._createWebSocket();this._stompHandler=new Ne(this,e,{debug:this.debug,stompVersions:this.stompVersions,connectHeaders:this.connectHeaders,disconnectHeaders:this._disconnectHeaders,heartbeatIncoming:this.heartbeatIncoming,heartbeatOutgoing:this.heartbeatOutgoing,splitLargeFrames:this.splitLargeFrames,maxWebSocketChunkSize:this.maxWebSocketChunkSize,forceBinaryWSFrames:this.forceBinaryWSFrames,logRawCommunication:this.logRawCommunication,appendMissingNULLonIncoming:this.appendMissingNULLonIncoming,discardWebsocketOnCommFailure:this.discardWebsocketOnCommFailure,onConnect:t=>{if(this._connectionWatcher&&(clearTimeout(this._connectionWatcher),this._connectionWatcher=void 0),!this.active){this.debug("STOMP got connected while deactivate was issued, will disconnect now"),this._disposeStompHandler();return}this.onConnect(t)},onDisconnect:t=>{this.onDisconnect(t)},onStompError:t=>{this.onStompError(t)},onWebSocketClose:t=>{this._stompHandler=void 0,this.state===x.DEACTIVATING&&this._changeState(x.INACTIVE),this.onWebSocketClose(t),this.active&&this._schedule_reconnect()},onWebSocketError:t=>{this.onWebSocketError(t)},onUnhandledMessage:t=>{this.onUnhandledMessage(t)},onUnhandledReceipt:t=>{this.onUnhandledReceipt(t)},onUnhandledFrame:t=>{this.onUnhandledFrame(t)}}),this._stompHandler.start()})}_createWebSocket(){let e;if(this.webSocketFactory)e=this.webSocketFactory();else if(this.brokerURL)e=new WebSocket(this.brokerURL,this.stompVersions.protocolVersions());else throw new Error("Either brokerURL or webSocketFactory must be provided");return e.binaryType="arraybuffer",e}_schedule_reconnect(){this.reconnectDelay>0&&(this.debug(`STOMP: scheduling reconnection in ${this.reconnectDelay}ms`),this._reconnector=setTimeout(()=>{this._connect()},this.reconnectDelay))}deactivate(){return tt(this,arguments,function*(e={}){let t=e.force||!1,n=this.active,r;if(this.state===x.INACTIVE)return this.debug("Already INACTIVE, nothing more to do"),Promise.resolve();if(this._changeState(x.DEACTIVATING),this._reconnector&&(clearTimeout(this._reconnector),this._reconnector=void 0),this._stompHandler&&this.webSocket.readyState!==k.CLOSED){let s=this._stompHandler.onWebSocketClose;r=new Promise((o,a)=>{this._stompHandler.onWebSocketClose=l=>{s(l),o()}})}else return this._changeState(x.INACTIVE),Promise.resolve();return t?this._stompHandler?.discardWebsocket():n&&this._disposeStompHandler(),r})}forceDisconnect(){this._stompHandler&&this._stompHandler.forceDisconnect()}_disposeStompHandler(){this._stompHandler&&this._stompHandler.dispose()}publish(e){this._checkConnection(),this._stompHandler.publish(e)}_checkConnection(){if(!this.connected)throw new TypeError("There is no underlying STOMP connection")}watchForReceipt(e,t){this._checkConnection(),this._stompHandler.watchForReceipt(e,t)}subscribe(e,t,n={}){return this._checkConnection(),this._stompHandler.subscribe(e,t,n)}unsubscribe(e,t={}){this._checkConnection(),this._stompHandler.unsubscribe(e,t)}begin(e){return this._checkConnection(),this._stompHandler.begin(e)}commit(e){this._checkConnection(),this._stompHandler.commit(e)}abort(e){this._checkConnection(),this._stompHandler.abort(e)}ack(e,t,n={}){this._checkConnection(),this._stompHandler.ack(e,t,n)}nack(e,t,n={}){this._checkConnection(),this._stompHandler.nack(e,t,n)}};var wi=(()=>{class i{constructor(t){this.ngZone=t,this.messageSubject=new Zt(null),this.messages$=this.messageSubject.asObservable(),this.backendUrl="",typeof window<"u"?this.backendUrl=window.location.origin.includes("localhost")?"ws://localhost:8080/ws":"ws://backend:8080/ws":this.backendUrl="ws://backend:8080/ws",this.stompClient=new Fe({brokerURL:this.backendUrl,reconnectDelay:5e3,debug:n=>console.log(n)}),this.stompClient.onConnect=()=>{console.log("Connected to WebSocket"),this.subscribeToMessages()},this.stompClient.activate()}subscribeToMessages(){this.stompClient.subscribe("/topic/public",t=>{console.log("Received:",t.body);let n=JSON.parse(t.body);this.ngZone.run(()=>{this.messageSubject.next(n)})})}sendMessage(t){this.stompClient.active?this.stompClient.publish({destination:"/app/chat.sendMessage",body:JSON.stringify(t),headers:{}}):console.error("WebSocket connection is not active.")}static{this.\u0275fac=function(n){return new(n||i)(ei(ni))}}static{this.\u0275prov=nt({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Ni=(()=>{class i{constructor(t,n){this._renderer=t,this._elementRef=n,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(t,n){this._renderer.setProperty(this._elementRef.nativeElement,t,n)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static{this.\u0275fac=function(n){return new(n||i)(w(st),w(rt))}}static{this.\u0275dir=te({type:i})}}return i})(),wr=(()=>{class i extends Ni{static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=ii(i)))(r||i)}})()}static{this.\u0275dir=te({type:i,features:[de]})}}return i})(),Fi=new ee("");var xr={provide:Fi,useExisting:it(()=>Be),multi:!0};function Vr(){let i=at()?at().getUserAgent():"";return/android (\d+)/.test(i.toLowerCase())}var Dr=new ee(""),Be=(()=>{class i extends Ni{constructor(t,n,r){super(t,n),this._compositionMode=r,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!Vr())}writeValue(t){let n=t??"";this.setProperty("value",n)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static{this.\u0275fac=function(n){return new(n||i)(w(st),w(rt),w(Dr,8))}}static{this.\u0275dir=te({type:i,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,r){n&1&&Me("input",function(o){return r._handleInput(o.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(o){return r._compositionEnd(o.target.value)})},features:[ot([xr]),de]})}}return i})();var Ar=new ee(""),kr=new ee("");function Ii(i){return i!=null}function Ti(i){return fi(i)?Xt(i):i}function Pi(i){let e={};return i.forEach(t=>{e=t!=null?y(y({},e),t):e}),Object.keys(e).length===0?null:e}function Bi(i,e){return e.map(t=>t(i))}function Mr(i){return!i.validate}function Li(i){return i.map(e=>Mr(e)?e:t=>e.validate(t))}function Or(i){if(!i)return null;let e=i.filter(Ii);return e.length==0?null:function(t){return Pi(Bi(t,e))}}function Ri(i){return i!=null?Or(Li(i)):null}function Nr(i){if(!i)return null;let e=i.filter(Ii);return e.length==0?null:function(t){let n=Bi(t,e).map(Ti);return Qt(n).pipe(Jt(Pi))}}function Ui(i){return i!=null?Nr(Li(i)):null}function xi(i,e){return i===null?[e]:Array.isArray(i)?[...i,e]:[i,e]}function Fr(i){return i._rawValidators}function Ir(i){return i._rawAsyncValidators}function ct(i){return i?Array.isArray(i)?i:[i]:[]}function Te(i,e){return Array.isArray(i)?i.includes(e):i===e}function Vi(i,e){let t=ct(e);return ct(i).forEach(r=>{Te(t,r)||t.push(r)}),t}function Di(i,e){return ct(e).filter(t=>!Te(i,t))}var Pe=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Ri(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Ui(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},ut=class extends Pe{get formDirective(){return null}get path(){return null}},ge=class extends Pe{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},ht=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},Tr={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},Ca=S(y({},Tr),{"[class.ng-submitted]":"isSubmitted"}),Wi=(()=>{class i extends ht{constructor(t){super(t)}static{this.\u0275fac=function(n){return new(n||i)(w(ge,2))}}static{this.\u0275dir=te({type:i,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,r){n&2&&oi("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},features:[de]})}}return i})();var pe="VALID",Ie="INVALID",re="PENDING",me="DISABLED";function Pr(i){return(Le(i)?i.validators:i)||null}function Br(i){return Array.isArray(i)?Ri(i):i||null}function Lr(i,e){return(Le(e)?e.asyncValidators:i)||null}function Rr(i){return Array.isArray(i)?Ui(i):i||null}function Le(i){return i!=null&&!Array.isArray(i)&&typeof i=="object"}var dt=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===pe}get invalid(){return this.status===Ie}get pending(){return this.status==re}get disabled(){return this.status===me}get enabled(){return this.status!==me}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(Vi(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(Vi(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(Di(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(Di(e,this._rawAsyncValidators))}hasValidator(e){return Te(this._rawValidators,e)}hasAsyncValidator(e){return Te(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=re,e.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=me,this.errors=null,this._forEachChild(n=>{n.disable(S(y({},e),{onlySelf:!0}))}),this._updateValue(),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(S(y({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(n=>n(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=pe,this._forEachChild(n=>{n.enable(S(y({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(S(y({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===pe||this.status===re)&&this._runAsyncValidator(e.emitEvent)),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?me:pe}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=re,this._hasOwnPendingAsyncValidator=!0;let t=Ti(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(n=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(n,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((n,r)=>n&&n._find(r),this)}getError(e,t){let n=t?this.get(t):this;return n&&n.errors?n.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new Ae,this.statusChanges=new Ae}_calculateStatus(){return this._allControlsDisabled()?me:this.errors?Ie:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(re)?re:this._anyControlsHaveStatus(Ie)?Ie:pe}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Le(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=Br(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=Rr(this._rawAsyncValidators)}};var ji=new ee("CallSetDisabledState",{providedIn:"root",factory:()=>ft}),ft="always";function Ur(i,e){return[...e.path,i]}function Wr(i,e,t=ft){Gr(i,e),e.valueAccessor.writeValue(i.value),(i.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(i.disabled),Hr(i,e),qr(i,e),$r(i,e),jr(i,e)}function Ai(i,e){i.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function jr(i,e){if(e.valueAccessor.setDisabledState){let t=n=>{e.valueAccessor.setDisabledState(n)};i.registerOnDisabledChange(t),e._registerOnDestroy(()=>{i._unregisterOnDisabledChange(t)})}}function Gr(i,e){let t=Fr(i);e.validator!==null?i.setValidators(xi(t,e.validator)):typeof t=="function"&&i.setValidators([t]);let n=Ir(i);e.asyncValidator!==null?i.setAsyncValidators(xi(n,e.asyncValidator)):typeof n=="function"&&i.setAsyncValidators([n]);let r=()=>i.updateValueAndValidity();Ai(e._rawValidators,r),Ai(e._rawAsyncValidators,r)}function Hr(i,e){e.valueAccessor.registerOnChange(t=>{i._pendingValue=t,i._pendingChange=!0,i._pendingDirty=!0,i.updateOn==="change"&&Gi(i,e)})}function $r(i,e){e.valueAccessor.registerOnTouched(()=>{i._pendingTouched=!0,i.updateOn==="blur"&&i._pendingChange&&Gi(i,e),i.updateOn!=="submit"&&i.markAsTouched()})}function Gi(i,e){i._pendingDirty&&i.markAsDirty(),i.setValue(i._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1}function qr(i,e){let t=(n,r)=>{e.valueAccessor.writeValue(n),r&&e.viewToModelUpdate(n)};i.registerOnChange(t),e._registerOnDestroy(()=>{i._unregisterOnChange(t)})}function zr(i,e){if(!i.hasOwnProperty("model"))return!1;let t=i.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function Yr(i){return Object.getPrototypeOf(i.constructor)===wr}function Kr(i,e){if(!e)return null;Array.isArray(e);let t,n,r;return e.forEach(s=>{s.constructor===Be?t=s:Yr(s)?n=s:r=s}),r||n||t||null}function ki(i,e){let t=i.indexOf(e);t>-1&&i.splice(t,1)}function Mi(i){return typeof i=="object"&&i!==null&&Object.keys(i).length===2&&"value"in i&&"disabled"in i}var Zr=class extends dt{constructor(e=null,t,n){super(Pr(t),Lr(n,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Le(t)&&(t.nonNullable||t.initialValueIsDefault)&&(Mi(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(n=>n(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){ki(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){ki(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){Mi(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var Xr={provide:ge,useExisting:it(()=>pt)},Oi=Promise.resolve(),pt=(()=>{class i extends ge{constructor(t,n,r,s,o,a){super(),this._changeDetectorRef=o,this.callSetDisabledState=a,this.control=new Zr,this._registered=!1,this.name="",this.update=new Ae,this._parent=t,this._setValidators(n),this._setAsyncValidators(r),this.valueAccessor=Kr(this,s)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let n=t.name.previousValue;this.formDirective.removeControl({name:n,path:this._getPath(n)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),zr(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){Wr(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){Oi.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let n=t.isDisabled.currentValue,r=n!==0&&mi(n);Oi.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?Ur(t,this._parent):[t]}static{this.\u0275fac=function(n){return new(n||i)(w(ut,9),w(Ar,10),w(kr,10),w(Fi,10),w(pi,8),w(ji,8))}}static{this.\u0275dir=te({type:i,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[Ve.None,"disabled","isDisabled"],model:[Ve.None,"ngModel","model"],options:[Ve.None,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[ot([Xr]),de,ti]})}}return i})();var Jr=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=I({type:i})}static{this.\u0275inj=F({})}}return i})();var Hi=(()=>{class i{static withConfig(t){return{ngModule:i,providers:[{provide:ji,useValue:t.callSetDisabledState??ft}]}}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=I({type:i})}static{this.\u0275inj=F({imports:[Jr]})}}return i})();function es(i,e){if(i&1&&(W(0,"li"),ie(1),j()),i&2){let t=e.$implicit;$(),ci("",t.sender,": ",t.content,"")}}var Re=(()=>{class i{constructor(t){this.wsService=t,this.title="websocketapp",this.newMessage="",this.messages=[]}ngOnInit(){this.wsService.messages$.subscribe(t=>{t&&this.messages.push(t)})}sendMessage(){this.newMessage.trim()&&(this.wsService.sendMessage({sender:"User",content:this.newMessage}),this.newMessage="")}static{this.\u0275fac=function(n){return new(n||i)(w(wi))}}static{this.\u0275cmp=De({type:i,selectors:[["app-root"]],decls:9,vars:2,consts:[[1,"container","d-flex","flex-column","vh-100"],[1,"flex-grow-1","overflow-auto","p-3",2,"max-height","80vh"],[1,"list-unstyled"],[4,"ngFor","ngForOf"],[1,"input-group","fixed-bottom","p-3"],["placeholder","Type your message here","aria-label","With textarea",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-dark",3,"click"]],template:function(n,r){n&1&&(W(0,"div",0)(1,"div",1)(2,"ul",2),ri(3,es,2,2,"li",3),j()(),W(4,"div",4)(5,"textarea",5),di("ngModelChange",function(o){return hi(r.newMessage,o)||(r.newMessage=o),o}),j(),W(6,"button",6),Me("click",function(){return r.sendMessage()}),ie(7,"Send"),j()()(),ke(8,"router-outlet")),n&2&&($(3),si("ngForOf",r.messages),$(2),ui("ngModel",r.newMessage))},dependencies:[gi,bi,Be,Wi,pt]})}}return i})();var $i=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=I({type:i,bootstrap:[Re]})}static{this.\u0275inj=F({providers:[yi()],imports:[_i,Ei,Hi]})}}return i})();var ts=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=I({type:i,bootstrap:[Re]})}static{this.\u0275inj=F({imports:[$i,vi]})}}return i})();global.WebSocket=br();export{ts as a};
